---
title: 工作笔记之流媒体相关
date: 2020-05-26 23:46:47
updated: 2020-05-26 23:59:35
tags:
- 流媒体
categories:
- 工作笔记
---
# 工作笔记之流媒体相关
## 前言
来到新东家的头个任务是实现一个pc，手机浏览器都能观看的直播项目。截止目前暂且告一段落，了解到了许多不曾接触过的流媒体相关的内容，特此一记。
## 技术栈选型
当然是天下第一的react了，create-react-app脚手架搭建的基础项目已经足以应付目前的需求。为了方便后期拓展还引入了react-router。未使用ui框架，页面实现是基于css媒体查询的响应式。
## 直播原理
受限于目前水平，还无法很好地归纳直播原理，暂时先写一个个人的理解吧，后期随着了解深入还会修改
> 简单来说直播就是直播方从推流链接推流，播放方获取拉流链接交给video播放器，当媒体流过来时播放器解析流信息并播放

## 流媒体协议
### RTMP

### HDL
移动端和safari不支持该协议,适用于pc端，优点是延迟较低
请求的是.flv文件,
### HLS
pc和移动端均支持该协议，延迟较高
HLS协议会请求.m3u8文件，这个文件内包含有直播流的分片信息 .ts, 播放器再去请求这些分片信息资源实现播放

## 盗链和防盗链

## 小技巧
### + 一元运算符
`+new Date()` 等效于 `new Date().getTime()`,都是获取时间戳

## safari浏览器调试踩坑
### `...`操作符编译失败
或许是我的babel-polyfill没有配置好...
使用了`Object.assign()`暂时替代
### 正则表达式不支持后发断言
我想在获取的url里更新`timeStamp=123456`中的数字部分，使用正则后发断言在safari中会报错
```javascript
'timeStamp=123456'.replace(/(?<=timeStamp=)[\d]*/g, +new Date()) // safari报错
// 替换方案 ===> 
'timeStamp=123456'.replace(/timeStamp=[\d]*/g, 'timeStamp=' + +new Date()) // low了点
```
### new Date(format) format不支持 YYYY-MM-DD 格式
safari中使用 `+new Date('2020-05-17 22:13:15')`时不会返回预期时间戳，会返回`Invalid Date`
解决方法是将日期中的`-`替换成`/`
`+new Date('2020-05-17 22:13:15'.replace(/\-/g, '/'))`
