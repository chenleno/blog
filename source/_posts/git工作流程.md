---
title: git工作流程
date: 2021-05-20 10:31:06
updated: 2021-05-20 10:44:02
categories: 
- 工作流
tags:
- git
---
# git 工作流程
基于现有git工作流的补充完善,使其更加贴合目前项目诉求
## 现有工作流优缺点
- 优点
  + pr审核流程一定程度上降低了bug率，提高了代码质量
  + 各分支分工明确，提高了工作效率
- 缺点
  + pr发起或审核不及时会导致pr过大，增加审核时间成本
  + feature 分支目前有些冗余，分别有 版本, 功能, 和 个人 开发分支
  + 项目存在封版但不上线的情况，这种情形下，feature分支和dev分支存在共存问题，增加了分支维护成本和复杂度

为解决以上问题，现提出新git工作流方案，对现有流程做了一定程度的简化和补充
## git 工作流说明
### 名词解释
- 迭代：产品主导开需求宣讲会，研发确认所有功能需求，并给出开始时间和结束时间，即为一期迭代
- 线上分支：`master` 分支
- 稳定分支: `dev` 分支
- 版本分支：该期迭代所有需求的最终合并分支，一般以 `pc/feature/ + [迭代开始日期]_[版本号]`命名，例：`pc/feature/210330_v4.4.0`
- 功能分支：该期迭代所有需求的具体功能分支，基于版本分支创建，后缀为具体功能名称，例`pc/feature/210330_v4.4.0_[功能名称]`
- 个人分支：如功能分支需要多人协作开发，则具体开发人员基于功能分支创建个人开发分支，后缀为个人姓名缩写，例：`pc/feature/210330_v4.4.0_[功能名称]_[姓名缩写]` (4.4.0版本xx功能，xx开发分支)。功能分支不需要多人协作时，不创建个人分支，直接在功能分支上开发
- 发包：需求开发或测试过程中，将打包后的h5包上传到 对应 环境
- 发版：单指将打包后的h5包上传到 `生产` 环境
- 提测：该期迭代所有需求开发完成，在版本分支打包并发包至 `测试` 环境交由测试
- 封版：需求开发完成并测试结束，产品宣布通过验收，该版本分支即成为封版分支，不再合并任何代码
- 指向：需求开发完成并封版，产品宣布将最后一次 `生产` 环境测试的包提供给用户使用
### 分支说明
在原有分支的基础上增加了`master`分支用来对应线上指向版本，原`dev`分支作为稳定分支，对应最新封版版本，移除个人feature开发分支
- `master` (线上分支，对应线上指向版本)
- `hotfix` (线上问题修复分支，实时基于`master`创建)
  + `hotfix`分支用于修改线上紧急bug，需要时基于当前`master`分支实时创建，在`hotfix`上修改并测试通过后，合并到`master`，并删除该`hotfix`
- `dev` (稳定分支，对应当前最新封版版本)
  + 因当前项目存在封版但不指向的现象，故将dev分支作为稳定分支实时对应当前最新封版版本
- `feature` (`feature`是一个概念，包含所有基于该期迭代创建的分支)
  + `版本feature`（即该期迭代版本分支，基于此分支创建的功能分支开发的功能最终都要合并到此分支上，该分支会在封版后合并到 `dev` 并隐藏）
    - 当前版本的走查、补充、测试和bug修复均在此分支进行
  + `功能feature`（基于当前版本分支创建，根据具体需求数量可以创建多个，功能分支在开发到一定进度或开发完成时要以 `pr` 的形式合并到版本分支上，版本分支提测后，删除所有该期功能分支）
  + `个人feature` (功能分支需要多人协作时才可创建，个人分支在开发到一定进度或开发完成时要以 `pr` 的形式合并到功能分支上，远端个人分支即合即删)
### 工作流程说明
该流程模拟了一次完整的迭代开发所需要进行的git流操作
1. 需求宣讲会结束，明确功能点为 A, B, 产品给出当期迭代版本号 v6.6.6, 迭代开始时间为 2021/6/6
2. 版本负责人基于当前 `dev` 分支创建版本分支，即 `pc/feature/210606_v6.6.6`
3. 版本负责人基于版本分支 `pc/feature/210606_v6.6.6` 创建功能分支，即 `pc/feature/210606_v6.6.6_A` 和 `pc/feature/210606_v6.6.6_B`
4. 功能开发人员基于功能分支开始开发功能
5. 功能开发完毕，各功能开发人员基于自己的功能分支发起 `pr` 至版本分支 `pc/feature/210606_v6.6.6`
6. `pr` 合并完毕，版本负责人基于版本分支打包，并发包至 `测试` 环境，开始提测。提测后删除远端所有该版本分支下的功能分支
7. 测试过程中，各开发人员基于版本分支创建自己的bug修复分支,（暂定 `fixbug_v6.6.6_[姓名缩写]`）,bug修改也以`pr`的方式提交到版本分支，远端bug修复分支即合即删
8. 测试完成，产品宣布验收通过可以封版，版本负责人将该版本分支合并到`dev`分支，并将远端该版本分支隐藏
9. 如产品宣布该版本指向给客户，组长将`dev`分支合并到`master`分支
### 异常流程处理
以下为可能遇到的异常流程处理方案，如有不足可补充
1. 指向版本出现bug
  - 需要紧急修复，基于当前`master`分支创建`hotfix`分支，在`hotfix`上修改bug并交由测试通过，将`hotfix`分支合并到`master`并基于`master`打包发版，然后删除该`hotfix`。操作完成后需在钉钉群里@所有人，说明改动情况，进行信息同步
  - 不需要紧急修复，找到下一个进行中的版本分支创建`coldfix`分支，在`coldfix`上修改bug并自测通过，在`coldfix`发起`pr`到对应版本分支，通知版本负责人审合`pr`后，删除该`coldfix`。版本负责人要在提测时通知测试该bug修复情况

### 注意事项
1. 为了避免单次`pr`包含的代码量过大导致难以审核，各功能开发人员需要在开发达到一定节点后就主动发起，可以少量多次
